<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<link rel="stylesheet" href="style.css" />
		<link
			rel="shortcut icon"
			href="https://oyster.ignimgs.com/mediawiki/apis.ign.com/balatro/e/ef/Joker.png"
			type="image/x-icon"
		/>
		<title>Blog Balatros</title>
	</head>
	<body>
		<!-- V√≠deo de fundo -->
		<video id="background-video" autoplay loop muted>
			<source src="src\assets\background\background_balatro.mp4" type="video/mp4" />
			Seu navegador n√£o suporta v√≠deos.
		</video>

		<header class="cabe√ßalho" id="cabe√ßalho_blog">
			<img src="src/assets/UI/logo.png" alt="blog ads">
		</header>

		<main id="principal">
			<div class="afasta-esquerda">
				<h2 id="bloco-titulo">Sobre o IFPI</h2>
					<div class="caixa-transparente">
						<p>
							O Instituto Federal do Piau√≠ (IFPI) √© uma institui√ß√£o
							p√∫blica de ensino que desempenha um papel crucial na
							democratiza√ß√£o da educa√ß√£o e no desenvolvimento
							socioecon√¥mico do estado do Piau√≠. Com uma hist√≥ria
							marcada pelo compromisso com a inclus√£o e a qualidade
							educacional, o IFPI √© reconhecido como um dos principais
							pilares da educa√ß√£o no Brasil. Seu objetivo principal √©
							oferecer educa√ß√£o gratuita e de excel√™ncia para
							estudantes de todas as idades e origens, promovendo
							igualdade de oportunidades e incentivando o crescimento
							pessoal e profissional
						</p>
						<p>
							A estrutura do IFPI est√° distribu√≠da em diversas cidades
							do estado, tornando a institui√ß√£o acess√≠vel para um
							n√∫mero cada vez maior de pessoas. Cada campus √© equipado
							com instala√ß√µes modernas e tecnologia avan√ßada,
							proporcionando aos alunos um ambiente prop√≠cio para o
							aprendizado. Desde laborat√≥rios especializados at√©
							bibliotecas completas, o IFPI se esfor√ßa para oferecer
							recursos educacionais de alta qualidade que auxiliam no
							desenvolvimento acad√™mico e t√©cnico.
						</p>
						<p>
							Al√©m dos cursos t√©cnicos, o IFPI tamb√©m se destaca por
							oferecer ensino m√©dio integrado, gradua√ß√£o e
							p√≥s-gradua√ß√£o. Essa ampla variedade de modalidades
							educacionais permite que os estudantes escolham o
							caminho mais adequado √†s suas aspira√ß√µes e objetivos.
							Para os jovens que desejam se preparar para o mercado de
							trabalho, os cursos t√©cnicos oferecem capacita√ß√£o
							pr√°tica e direta em √°reas espec√≠ficas. J√° para aqueles
							que buscam aprofundar seus conhecimentos e ingressar em
							carreiras acad√™micas, os programas de gradua√ß√£o e
							p√≥s-gradua√ß√£o do IFPI s√£o reconhecidos nacionalmente
							pela sua excel√™ncia.
						</p>
					</div>
				</div>
			<div class="caixa-bot√£o">
                <button class="bloco-bot√£o" id="botao_postagens">Postagens</button>
                <button class="bloco-bot√£o" id="botao_autores">Autores</button>
                <button class="bloco-bot√£o" id="botao_links">Links</button>
            </div>
		</main>

		<div id="tela-postagens">
			<div id="conteudo-postagens"></div>
			<!-- <button id="fechar-postagens" class="bloco-bot√£o" onclick="fecharTela('postagens')">Fechar</button> -->
		</div>
		
		<div id="tela-autores" class="tela-sobreposta">
			<h1 class="titulo-autores">Autores</h1>
			<div id="conteudo-autores"></div> <!-- Aqui o conte√∫do ser√° inserido -->
			<button id="fechar-autores" class="bloco-bot√£o" onclick="fecharTela('autores')">Fechar</button>
		</div>

		<div id="tela-links">
			<div id="conteudo-links"></div>
		</div>

		<script>
			function abrirTela(telaId) {
				window.scrollTo(0, document.body.scrollHeight);
				
				const tela = document.getElementById('tela-' + telaId);
				const botaoFechar = document.getElementById('fechar-' + telaId);
				const tela_principal = document.getElementById('principal');
				const cabe√ßalho_blog = document.getElementById('cabe√ßalho_blog');
				const rodape_blog = document.getElementById('rodape');

				if (botaoFechar) botaoFechar.disabled = true;
				document.body.style.overflow = 'hidden';

				tela.style.display = 'block';

				// üõ†Ô∏è Resetar anima√ß√£o antiga antes de animar
				tela.style.animation = 'none';
				void tela.offsetWidth;
				if (tela.id !== 'tela-postagens') {
					tela.style.animation = 'subirTela 0.4s ease-out forwards';
				}

				tela_principal.style.transition = 'opacity 0.4s';
				tela_principal.style.opacity = '0';
				cabe√ßalho_blog.style.transition = 'opacity 0.4s';
				cabe√ßalho_blog.style.opacity = '0';
				rodape_blog.style.transition = 'opacity 0.4s';
				rodape_blog.style.opacity = '0';

				setTimeout(() => {
					tela_principal.style.display = 'none';
					cabe√ßalho_blog.style.display = 'none';
					tela.classList.add("abrindo");
				}, 400);

				tela.addEventListener('animationend', function handleAnimAbrir() {
					if (botaoFechar) botaoFechar.disabled = false;
					tela.removeEventListener('animationend', handleAnimAbrir);
				});
			}

			function handleAnim(tela) {
				tela.style.display = 'none';
				document.body.style.overflow = 'auto';
				tela.scrollTop = 0; // reseta o scroll da tela
				tela.classList.remove("abrindo"); // remove a anima√ß√£o
				void tela.offsetWidth; // truque para for√ßar "reflow" no navegador

				const tela_principal = document.getElementById('principal');
				const cabe√ßalho_blog = document.getElementById('cabe√ßalho_blog');
				const rodape_blog = document.getElementById('rodape');

				tela_principal.style.display = 'flex'; // ou 'block', o que era no come√ßo
				cabe√ßalho_blog.style.display = 'block';
				rodape_blog.style.display = 'block'; // se o rodap√© tamb√©m sumiu


				// Reativa o bot√£o ap√≥s a anima√ß√£o
				void tela_principal.offsetWidth;

				tela_principal.style.opacity = '1';
				cabe√ßalho_blog.style.opacity = '1';
				rodape_blog.style.opacity = '1';

				// Remove o event listener para n√£o acumular v√°rios
				tela.removeEventListener('animationend', handleAnim);
			}

			// Fun√ß√£o para fechar a tela sobreposta
			function fecharTela(telaId) {
				const tela = document.getElementById('tela-' + telaId);
				const botaoFechar = document.getElementById('fechar-' + telaId);

				// Desativa o bot√£o temporariamente
				botaoFechar.disabled = true;
				
				if (tela.id !== 'tela-postagens') {
					tela.style.top = '50%';
					tela.style.left = '50%';
					tela.style.transform = 'translate(-50%, -50%)';
					tela.style.animation = 'descerTela 0.4s ease-out forwards';		
				} else {
					handleAnim(tela);
				}


				tela.addEventListener('animationend', handleAnim(tela));
			};

			// Adiciona eventos para os bot√µes
			document.querySelector('#botao_postagens').addEventListener('click', () => {
				abrirTela('postagens');
			});

			document.querySelector('#botao_autores').addEventListener('click', () => {
				abrirTela('autores');
				const conteudoAutores = document.getElementById('conteudo-autores');

				// Carrega o conte√∫do do arquivo autores.html
				fetch('src/components/authors/authors.html')
					.then(response => response.text())
					.then(html => {
						conteudoAutores.innerHTML = html;
					})
					.catch(error => console.error('Erro ao carregar os autores:', error));
				});


				document.querySelector('#botao_links').addEventListener('click', () => {
					const telaPreta = document.getElementById('tela-preta');

					// Ativa a tela preta
					telaPreta.classList.add('ativo');

					// Ap√≥s um breve delay para dar o efeito de transi√ß√£o
					setTimeout(() => {
						// Carrega a nova p√°gina "links.html"
						window.location.href = "src/components/links/links.html";  // Isso carrega a p√°gina completa
					}, 500); // Espera meio segundo antes de redirecionar
				});

				document.querySelector('#botao_postagens').addEventListener('click', () => {
					console.debug('Bot√£o de postagens clicado');
					abrirTela('postagens');
					const conteudoPostagens = document.getElementById('conteudo-postagens');

					fetch('src/components/posts/posts.html')
						.then(response => {
							console.debug('Resposta recebida do fetch:', response);
							return response.text();
						})
						.then(html => {
							console.debug('HTML carregado:', html);
							conteudoPostagens.innerHTML = html;

							// Executa todos os scripts internos do HTML carregado
							conteudoPostagens.querySelectorAll('script').forEach(oldScript => {
								const newScript = document.createElement('script');
								
									if (oldScript.src) {
										console.debug('Carregando script externo:', oldScript.src);
										newScript.src = oldScript.src;
									} else {
										console.debug('Executando script embutido');
										newScript.textContent = oldScript.textContent;
									}

									document.body.appendChild(newScript);
									document.body.removeChild(newScript);
							});
						})
						.catch(error => console.error('Erro ao carregar postagens:', error));
				});
				

			document.querySelector('#botao_postagens').addEventListener('click', async() => {
				abrirTela('postagens');
				
				await new Promise(resolve => setTimeout(resolve, 500));

				const postContainer = document.querySelector('.post-container');

				fetch('http://localhost:3000/api/posts')
					.then(response => response.json())
					.then(posts => {
						postContainer.innerHTML = ''; // Limpa antes de adicionar

						posts.forEach(post => {
							// Monta o HTML para os coment√°rios existentes
							let comentariosHTML = '';
							post.comentarios.forEach(comentario => {
								comentariosHTML += `
									<div class="comentario">
										<strong>${comentario.autor}:</strong> ${comentario.texto}
									</div>
								`;
							});

							const postElement = document.createElement('div');
							postElement.className = 'post';
							postElement.id = post.id_secao;

							// Template completo do post com a se√ß√£o de coment√°rios
							postElement.innerHTML = `
								<h2>${post.titulo}</h2>
								${post.conteudoHTML}
								<p class="data-autor">${post.data} - por ${post.autor}</p>
								
								<div class="comentarios">
									<button class="toggle-comentarios">Mostrar Coment√°rios</button>
									<div class="area-comentarios" style="display: none;">
										<div class="lista-comentarios">${comentariosHTML}</div>
										<form class="form-comentario" data-postid="${post._id}">
											<input type="text" class="input-autor-comentario" placeholder="Seu nome" required>
											<input type="text" class="input-comentario" placeholder="Digite um coment√°rio..." required>
											<button type="submit">Comentar</button>
										</form>
									</div>
								</div>
							`;
							postContainer.appendChild(postElement);

							// --- Adiciona a l√≥gica para CADA post ---

							// L√≥gica para mostrar/ocultar coment√°rios
							const toggleBtn = postElement.querySelector('.toggle-comentarios');
							const areaComentarios = postElement.querySelector('.area-comentarios');
							toggleBtn.addEventListener('click', () => {
								const isHidden = areaComentarios.style.display === 'none';
								areaComentarios.style.display = isHidden ? 'block' : 'none';
								toggleBtn.textContent = isHidden ? 'Ocultar Coment√°rios' : 'Mostrar Coment√°rios';
							});

							// L√≥gica para adicionar um novo coment√°rio
							const formComentario = postElement.querySelector('.form-comentario');
							formComentario.addEventListener('submit', async function(e) {
								e.preventDefault();
								const postId = this.dataset.postid;
								const autor = this.querySelector('.input-autor-comentario').value.trim();
								const texto = this.querySelector('.input-comentario').value.trim();

								if (autor && texto) {
									try {
										const response = await fetch(`http://localhost:3000/api/posts/${postId}/comments`, {
											method: 'POST',
											headers: { 'Content-Type': 'application/json' },
											body: JSON.stringify({ autor, texto })
										});
										if (!response.ok) throw new Error('Falha ao enviar coment√°rio');

										// Adiciona o coment√°rio visualmente na hora
										const listaComentarios = this.previousElementSibling; // Pega a div .lista-comentarios
										const comentarioDiv = document.createElement('div');
										comentarioDiv.className = 'comentario';
										comentarioDiv.innerHTML = `<strong>${autor}:</strong> ${texto}`;
										listaComentarios.appendChild(comentarioDiv);
										this.reset(); // Limpa o formul√°rio

									} catch (error) {
										console.error("Erro ao comentar:", error);
										alert("N√£o foi poss√≠vel adicionar o coment√°rio.");
									}
								}
							});
						});
					})
					.catch(error => {
						console.error('Erro ao buscar posts:', error);
						postContainer.innerHTML = `<p style="color:red;">Falha ao carregar posts.</p>`;
					});
			});

		</script>
		
		<footer class="project-footer" id="rodape">
			<p>Projeto desenvolvido por <strong>Arthur Vieira, Iglesio Carvalho, N√≠colas Rafael</strong> ‚Äì IFPI ¬© 2025</p>
			<p>Todos os direitos reservados. Parte do projeto: <strong>Blog ADS Balatro IFPI</strong></p>
		</footer>  

		<!-- Tela preta durante transi√ß√£o -->
		<div id="tela-preta"></div>

		</div>
  
	</body>
</html>